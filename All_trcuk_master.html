<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        #banner {
            background-color: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        td {
            background-color: #f2f2f2;
        }
        td.file-path {
            max-width: 11ch;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        td.expired {
            background-color: #dc3545;
            color: white;
            cursor: pointer;
        }
        td.expired:hover::after {
            content: "Expired";
            position: absolute;
            background-color: black;
            color: white;
            padding: 5px;
            border-radius: 5px;
            white-space: nowrap;
        }
        .green {
            background-color: #28a745;
            color: white;
        }
        .red {
            background-color: #dc3545;
            color: white;
        }
        .column-wide {
            min-width: 17ch;
        }
    </style>
</head>
<body>
    <div id="banner">
        Total Transporters: <span id="totalTransporters"></span>, Total Vehicles: <span id="totalVehicles"></span>
    </div>
    <h1>Vehicle Data</h1>
    <table id="vehicleData">
        <thead>
            <tr>
                <th>Vehicle Number</th>
                <th>Name Of Transport</th>
                <th>Contact No</th>
                <th class="column-wide">Un Laden Weight</th>
                <th class="column-wide">Loaden Weight</th>
                <th class="column-wide">Fitness Valid up to</th>
                <th class="column-wide">Tax Valid up to</th>
                <th class="column-wide">Insurance Valid up to</th>
                <th class="column-wide">PUCC Valid up to</th>
                <th class="column-wide">Permit Valid up to</th>
                <th class="file-path">File Path PDF</th>
                <th>GPS Installed Status</th>
                <th>Active Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data from Google Sheets will be inserted here -->
        </tbody>
    </table>

    <script>
        const sheetID = '1ZPgjRlPruFAXoLfFFotEoEMC1EdKgyGxvskXT4X3ElA';  // Your Google Sheet ID
        const apiKey = 'AIzaSyDV0TQQ_dVAzs9pXb4KBN9xJkrM4q7Tv2s';  // Your API key

        function fetchData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/Mainsheet?key=${apiKey}`;
            const today = new Date();

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values;
                    const table = document.getElementById('vehicleData').getElementsByTagName('tbody')[0];

                    let totalEntries = 0;
                    let totalInstalled = 0;
                    let totalNotInstalled = 0;
                    let totalActive = 0;
                    let totalNotActive = 0;

                    let transportCounts = {};
                    let totalVehicles = 0;

                    for (let i = 1; i < rows.length; i++) {  // Start from index 1 to skip the header row
                        const row = rows[i];
                        const newRow = table.insertRow();

                        totalVehicles++;

                        const transportName = row[1]; // Column B (Transport Name)
                        if (transportCounts[transportName]) {
                            transportCounts[transportName]++;
                        } else {
                            transportCounts[transportName] = 1;
                        }

                        for (let j = 0; j < row.length; j++) {
                            const cell = newRow.insertCell();
                            cell.textContent = row[j];

                            // Highlight expired dates
                            if ([5, 6, 7, 8, 9].includes(j)) { // Columns for expiry dates
                                cell.classList.add('column-wide');
                                const cellDate = new Date(row[j]);
                                if (cellDate < today) {
                                    cell.classList.add('expired');
                                }
                            }

                            if (j === 11) {  // GPS Installed Status (column index 11)
                                const status = row[j].toUpperCase();
                                if (status === 'INSTALLED') {
                                    cell.classList.add('green');
                                    totalInstalled++;
                                } else if (status === 'NOT INSTALLED') {
                                    cell.classList.add('red');
                                    totalNotInstalled++;
                                }
                            }

                            if (j === 12) {  // Active Status (column index 12)
                                const status = row[j].toUpperCase();
                                if (status === 'ACTIVE') {
                                    cell.classList.add('green');
                                    totalActive++;
                                } else if (status === 'NOT ACTIVE') {
                                    cell.classList.add('red');
                                    totalNotActive++;
                                }
                            }

                            if (j === 10) { // File Path PDF
                                cell.classList.add('file-path');
                            }
                        }

                        totalEntries++;
                    }

                    document.getElementById('totalTransporters').textContent = Object.keys(transportCounts).length;
                    document.getElementById('totalVehicles').textContent = totalVehicles;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        window.onload = fetchData;
    </script>
</body>
</html>
